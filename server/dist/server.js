"use strict";
var path = require('path');
var config_1 = require('./config');
var express = require('express');
var io = require('socket.io')();
var app = express();
var webServer = require('./bin/webServer');
var controllers = require('./controllers');
var ROOT = path.join(__dirname, '../../');
var DIST_PATH = path.join(ROOT, 'dist/public');
var ASSETS_PATH = path.join(ROOT, 'client/assets');
app.io = io;
app.set('host', config_1.default.host || '0.0.0.0');
app.set('port', config_1.default.port || 3000);
app.set('views', path.join(ROOT, 'server/views'));
app.use('/dist', express.static(DIST_PATH));
app.use('/assets', express.static(ASSETS_PATH));
app.use(controllers);
webServer.pre(function (server) {
    io.attach(server);
    var messages = [];
    io.on('connection', function (socket) {
        socket.emit('updateMessage', messages);
        socket.on('message', function (message) {
            messages.push(new Date() + '  ' + message);
            console.log(messages);
            socket.emit('updateMessage', messages);
            socket.broadcast.emit('updateMessage', messages);
        });
    });
});
webServer.after(function () {
    if (config_1.default.env === 'development') {
        var webpack = require('webpack');
        var webpackConfig = require(path.join(ROOT, 'webpack.client.config.js'));
        var webpackDevMiddleware = require('webpack-dev-middleware');
        var compiler = webpack(webpackConfig);
        app.use(webpackDevMiddleware(compiler, {}));
    }
});
webServer.run(app);

//# sourceMappingURL=data:application/json;base64,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QUMsQ0FBQztRQUMvRCxJQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7UUFHeEMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUc3QyxDQUFDO0FBRUYsQ0FBQyxDQUFDLENBQUM7QUFFSCxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDIiwiZmlsZSI6InNlcnZlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xuXG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgaW8gPSByZXF1aXJlKCdzb2NrZXQuaW8nKSgpO1xuY29uc3QgYXBwID0gZXhwcmVzcygpO1xuXG5jb25zdCB3ZWJTZXJ2ZXIgPSByZXF1aXJlKCcuL2Jpbi93ZWJTZXJ2ZXInKTtcbmNvbnN0IGNvbnRyb2xsZXJzID0gcmVxdWlyZSgnLi9jb250cm9sbGVycycpO1xuXG5cbmNvbnN0IFJPT1QgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vJyk7XG5jb25zdCBESVNUX1BBVEggPSBwYXRoLmpvaW4oUk9PVCwgJ2Rpc3QvcHVibGljJyk7XG5jb25zdCBBU1NFVFNfUEFUSCA9IHBhdGguam9pbihST09ULCAnY2xpZW50L2Fzc2V0cycpO1xuXG5cbmFwcC5pbyA9IGlvO1xuXG5hcHAuc2V0KCdob3N0JywgY29uZmlnLmhvc3QgfHwgJzAuMC4wLjAnKTtcbmFwcC5zZXQoJ3BvcnQnLCBjb25maWcucG9ydCB8fCAzMDAwKTtcblxuXG5hcHAuc2V0KCd2aWV3cycsIHBhdGguam9pbihST09ULCAnc2VydmVyL3ZpZXdzJykpO1xuXG5hcHAudXNlKCcvZGlzdCcsIGV4cHJlc3Muc3RhdGljKERJU1RfUEFUSCkpO1xuYXBwLnVzZSgnL2Fzc2V0cycsIGV4cHJlc3Muc3RhdGljKEFTU0VUU19QQVRIKSk7XG5cbmFwcC51c2UoY29udHJvbGxlcnMpO1xuXG5cblxuXG53ZWJTZXJ2ZXIucHJlKChzZXJ2ZXIpID0+IHtcblxuXHRpby5hdHRhY2goc2VydmVyKTtcblxuXHRjb25zdCBtZXNzYWdlczogc3RyaW5nW10gPSBbXTtcblxuXHRpby5vbignY29ubmVjdGlvbicsIGZ1bmN0aW9uKHNvY2tldCkge1xuXG5cdFx0c29ja2V0LmVtaXQoJ3VwZGF0ZU1lc3NhZ2UnLG1lc3NhZ2VzKTtcblxuXHRcdHNvY2tldC5vbignbWVzc2FnZScsIGZ1bmN0aW9uKG1lc3NhZ2Upe1xuXHRcdFx0bWVzc2FnZXMucHVzaChuZXcgRGF0ZSgpICsgJyAgJyArIG1lc3NhZ2UpO1xuXHRcdFx0Y29uc29sZS5sb2cobWVzc2FnZXMpO1xuXHRcdFx0c29ja2V0LmVtaXQoJ3VwZGF0ZU1lc3NhZ2UnLCBtZXNzYWdlcyk7XG5cdFx0XHRzb2NrZXQuYnJvYWRjYXN0LmVtaXQoJ3VwZGF0ZU1lc3NhZ2UnLG1lc3NhZ2VzKTtcblx0XHR9KTtcblx0fSk7XG5cbn0pO1xuXG53ZWJTZXJ2ZXIuYWZ0ZXIoKCk9PiB7XG5cblx0aWYgKGNvbmZpZy5lbnYgPT09ICdkZXZlbG9wbWVudCcpIHtcblxuXHRcdGNvbnN0IHdlYnBhY2sgPSByZXF1aXJlKCd3ZWJwYWNrJyk7XG5cdFx0Y29uc3Qgd2VicGFja0NvbmZpZyA9IHJlcXVpcmUocGF0aC5qb2luKFJPT1QsICd3ZWJwYWNrLmNsaWVudC5jb25maWcuanMnKSk7XG5cdFx0Y29uc3Qgd2VicGFja0Rldk1pZGRsZXdhcmUgPSByZXF1aXJlKCd3ZWJwYWNrLWRldi1taWRkbGV3YXJlJyk7XG5cdFx0Y29uc3QgY29tcGlsZXIgPSB3ZWJwYWNrKHdlYnBhY2tDb25maWcpO1xuXG5cblx0XHRhcHAudXNlKHdlYnBhY2tEZXZNaWRkbGV3YXJlKGNvbXBpbGVyLCB7fSkpO1xuXG5cblx0fVxuXG59KTtcblxud2ViU2VydmVyLnJ1bihhcHApO1xuXG5cblxuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
